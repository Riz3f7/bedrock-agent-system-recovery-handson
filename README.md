# AWS Bedrock エージェント システム復旧ハンズオン

このプロジェクトは、AWS Bedrock エージェント（Amazon Nova Pro）を使用して、EC2インスタンス上で動作するFlaskアプリケーションのトラブルシューティングを自動化するシステムの構築手順を提供します。

## 🎯 プロジェクト概要

AWS Bedrockエージェントの力を活用して、システム障害の検出、分析、復旧を自動化する実践的なデモシステムです。

### 主な機能
- **自動ログ分析**: CloudWatch Logsからエラーログを取得・分析
- **インテリジェントな障害診断**: AIによる根本原因の特定
- **安全な自動復旧**: EC2インスタンスの自動再起動
- **自然言語でのシステム操作**: 日本語での直感的な操作

## 🏗️ アーキテクチャ

```
[ユーザー] → [Bedrock エージェント] → [Lambda関数] → [CloudWatch Logs / EC2]
                                    ↓
                              [ログ分析・インスタンス再起動]
                                    ↑
                            [Session Manager経由でアクセス]
```

## 📁 プロジェクト構成

```
bedrock-agent-system-recovery-handson/
├── README.md                                      # このファイル
├── ハンズオン手順書.md                             # 詳細な構築手順
├── bedrock-agent-env-template.yaml                # CloudFormationテンプレート（全リソース一括作成）
└── エージェント/
    ├── GetLogActionGroup_APIスキーマ.txt           # ログ取得アクション用APIスキーマ
    ├── reboot-instances-actiongroup_APIスキーマ.txt # 再起動アクション用APIスキーマ
    └── エージェントへの指示.txt                     # エージェント設定用指示文
```

**注意**: Lambda関数のソースコードはCloudFormationテンプレート内に直接埋め込まれています。

## 🚀 クイックスタート

### 前提条件
- AWSアカウント
- Amazon Nova Pro が利用可能なリージョン（推奨: us-east-1, us-west-2）
- 基本的なAWSサービスの知識

### 所要時間
約 1 時間

### 手順概要
1. **事前準備**: Amazon Nova Pro の有効化
2. **全システムの自動構築**: CloudFormationによる一括デプロイ（EC2、Lambda、IAMロール）
3. **Lambda関数のテスト**: 個別機能の動作確認
4. **Bedrock エージェントの作成**: エージェントとアクショングループの設定
5. **エージェントのテスト**: 実際のトラブルシューティングテスト
6. **動作確認**: CloudWatch Logsとシステム全体の確認

詳細な手順は [ハンズオン手順書.md](./ハンズオン手順書.md) を参照してください。

## 🔧 主要コンポーネント

### 1. EC2インスタンス **(CloudFormation自動作成)**
- Amazon Linux 2023ベース
- Flaskアプリケーション自動デプロイ
- CloudWatch Agentによるログ収集
- Session Manager接続設定

### 2. Lambda関数 **(CloudFormation自動作成)**
- **get-log関数**: CloudWatch Logsからエラーログを取得・分析
- **reboot-instances関数**: EC2インスタンスの安全な再起動
- Bedrockエージェント連携用レスポンス形式

### 3. IAMロール・ポリシー **(CloudFormation自動作成)**
- Lambda実行用権限
- CloudWatch Logs読み取り権限
- EC2操作権限

### 4. Bedrockエージェント **(手動作成)**
- 自然言語でのシステム操作
- 2つのアクショングループ（ログ取得・再起動）
- Amazon Nova Proモデル使用

## 🎮 使用例

### 基本的なトラブルシューティング
```
ユーザー: "システムの状況を確認してください"
エージェント: 
- CloudWatch Logsを確認
- エラーログの分析
- システム状態の報告
- 必要に応じて復旧提案
```

### 自動復旧
```
ユーザー: "エラーが発生しているインスタンスを再起動してください"
エージェント:
- エラーログの詳細分析
- 影響度の評価
- ユーザー確認後の安全な再起動実行
```

## 📊 特徴

### Amazon Nova Pro最適化
- 高いコスト効率性
- 優れた推論能力
- 日本語での自然な対話
- 技術的なトラブルシューティングに最適化

### セキュリティ
- IAMロールによる適切な権限制御
- Session Managerによる安全な接続
- ドライラン機能
- タグベースの保護機能

### 運用性
- CloudWatch Logsとの統合
- 構造化ログ出力
- 詳細な監査ログ
- エラーハンドリング

## 🧹 クリーンアップ

ハンズオン完了後は、コストを避けるため以下の順序でリソースを削除してください：

1. Bedrock エージェント
2. Lambda関数
3. IAMロール・ポリシー
4. CloudFormationスタック
5. CloudWatch Logs

詳細な削除手順は [ハンズオン手順書.md](./ハンズオン手順書.md) の「クリーンアップ」セクションを参照してください。

## 🤝 サポート

### トラブルシューティング
よくある問題と解決方法については、[ハンズオン手順書.md](./ハンズオン手順書.md) の「トラブルシューティング」セクションを参照してください。

### 改善提案
このプロジェクトへの改善提案やバグ報告は、Issues経由でお知らせください。

---

**注意**: このプロジェクトはデモ・学習目的です。本番環境での使用には、適切なセキュリティ設定、監視、バックアップ戦略の実装が必要です。